<script type='text/x-template' id='booposts-template'>
  <page2
    class='booposts vcomp'
    :onloading='onloading'
    :open='session.page.booposts.open'
    :trans_headerbar='true'
    :from='session.page.booposts.from'
    @close='session.close_page()'>

    <template #headerbar-menu>
      <div class='item' v-if='!is_mypost' @click='$refs.baseposts.report_this_post'>신고하기</div>
      <div class='item' v-if='is_mypost && cpost.id' @click='$refs.baseposts.modify_this_post'>수정하기</div>
      <div class='item' v-if='is_mypost && cpost.id' @click='$refs.baseposts.delete_this_post'>삭제</div>
    </template>

    <template #page-body>
      <baseposts :session='session' :postlist='postlist' :posts='session.booposts' ref='baseposts'></baseposts>
    </template>
  </page2>
</script>


<script>
  Vue.component('booposts', {
    template: '#booposts-template',
    delimiters: ['[[', ']]'],
    props: ['session'],
    data: function() {
      return {}
    },

    mounted: function() {
      this.session.page.booposts.swiper = this.$refs.baseposts.swiper;
    },

    computed: {
      onloading: function() {
        if (this.cpost) {
          return !this.cpost.id
        }
      },

      cpost: function() {
        if (this.session.page.booposts.swiper && this.postlist) {
          return this.postlist[this.session.page.booposts.swiper.realIndex]
        }

        // if (this.session.page.posts.swiper && this.postlist) {
        //   return this.postlist[this.session.page.posts.swiper.realIndex]
        // }
      },

      is_mypost: function() {
        if (this.session.auth) {
          return this.session.auth.boo_selected == this.cpost.boo.id
        }
      },

      postlist: function() {
        if (!this.session.booposts) {
          return []
        }

        const _postlist = this.session.booposts.list.map(post => {
          if (!post.id)
            return post

          const _post = _.find(this.session.page.posts.contents.list, ['id', post.id]);

          if (_post) {
            return _post;
          } else {
            return post
          }
        });

        // if (this.session.auth && this.session.booposts.boo.id in this.session.auth.boos) {
        //   _postlist.forEach(post => {
        //     post.boo = this.session.auth.boos[this.session.booposts.boo.id];
        //   });
        //
        // } else {
        //   _postlist.forEach(post => {
        //     post.boo = this.session.booposts.boo;
        //   });
        // }

        if (this.session.auth) {
          _postlist.forEach(post => {
            if (post.boo.id in this.session.auth.boos) {
              post.boo = this.session.auth.boos[post.boo.id];
            }
          });
        }

        return _postlist
      }
    }
  });
</script>
