<style>
  .editext {
    font-size: 12px;
    line-height: 1.4;
    white-space: pre-line;
    /* pre-line으로 해야 span 앞에 여백이 없어진다.. 왜? */
  }

  .editext > span.text[contentEditable=true]:empty::before {
    content: attr(placeholder);
    color: gray;
  }

  .editext > span {
    background: black;
    color: white;
    pointer-events: auto;
  }

  /* 중요참고: contenteditable은 swiper에서 안먹힌다. swiper에서 detachEvents를 해야한다 */
  .editext > span.text[contenteditable=true]:focus {
    font-size: 20px;
    line-height: 1.3;
    outline: none;
    /* display: inline-flex;
    justify-content: flex-end; */
  }

  .editext > span.header {
    color: gray;
  }

  /* .editext span.text[contentEditable=false]:empty {
    display: none;
  } */
</style>


<script type='text/x-template' id='editext-template'>
  <div class='editext'>
    <template v-if='header'>
      <span class='header'>[[ header ]]</span><br>
    </template>

    <span class='text' v-show='text || editable' :contenteditable='editable' spellcheck='false' :placeholder='placeholder' @input='change_text'></span>
  </div>
</script>

<script>
  Vue.component('editext', {
    template: '#editext-template',
    delimiters: ['[[', ']]'],
    props: ['rawtext', 'header', 'editable', 'placeholder'],
    data: function() {
      return {
        text: (this.rawtext ? this.rawtext : ''),
        changed: false
      }
    },

    mounted: function() {
      this.$el.querySelector('span.text').innerHTML = this.text;
      // this.$refs.text.innerHTML = this.text;
    },

    watch: {
      text: function(_new, _old) {
        this.changed = true;
      }
    },

    methods: {
      change_text: function(event) {
        this.text = event.currentTarget.innerHTML.replace(/<br>/gi,'\r\n').replace(/&nbsp;/gi,' ');
      },

      get: function() {
        if (this.changed) {
          this.changed = false;
          return this.text
        }
      }
    }
  });
</script>
