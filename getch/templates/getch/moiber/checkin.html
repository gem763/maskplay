<style>
  .checkin.vcomp .page-body {
    width: 100%;
    height: 100%;
  }


  .checkin.vcomp .page-body > .background {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .checkin.vcomp .page-body > .background > .content {
    position: relative;
    width: 100%;
    height: calc(100% - 100px);
    background: white;
    border-radius: 0 0 15px 15px;
    box-sizing: border-box;
    overflow: hidden;
  }
</style>


<script type='text/x-template' id='checkin-template'>
  <page
    class='checkin vcomp'
    :order='session.page.checkin.order'
    :open='session.page.checkin.open'
    :from='session.page.checkin.from'
    :hide_close='true'
    :hide_menu='true'
    :hide_headerbar='true'
    :trans_headerbar='true'
    @close='session.close_page()'>

    <template #page-body>
      <div class='background' @click='session.close_page()'>
        <div class='content' @click.stop>
          <flashgame :session='session' :flashgame='flashgame'></flashgame>
        </div>
      </div>
    </template>
  </page>
</script>


<script>
  Vue.component('checkin', {
    template: '#checkin-template',
    delimiters: ['[[', ']]'],
    props: ['session'],
    data: function() {
      return { }
    },

    watch: {
      flashgame: function(_new, _old) {
        if (_new) {
          if (!_new.answer || (_new.answer.length == 0)) {
            this.session.open_checkin();
          }
        }
      }
    },

    computed: {
      is_superuser: function() {
        if (this.session.user.has_auth) {
          return this.session.user.auth.is_superuser
        }
      },

      flashgames: function() {
        return this.session.flashgames
      },

      flashgame: function() {
        if (this.flashgames) {
          const _today = moment(new Date()).format('YYYY-MM-DD');

          if (this.is_superuser) {
            return _.filter(this.flashgames.list, { pub_date: _today })[0]
            // return _.filter(this.flashgames.list, function(o) {
            //   return (o.pub_date == _today) && (o.answer.length > 0)
            // })[0]

          } else if (this.session.user.has_auth) {
            return _.filter(this.flashgames.list, { pub_date: _today, published: true })[0]
            // return _.filter(this.flashgames.list, function(o) {
            //   return (o.pub_date == _today) && (o.answer.length > 0) && (o.published)
            // })[0]

          } else {
            // 로그인 안했더라도 출첵게임 보이게
            return _.filter(this.flashgames.list, { pub_date: _today, published: true })[0]
            // return
          }
        }
      }
    }
  });
</script>
