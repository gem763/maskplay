<style>
  .researchitem {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #f8f8f8;
  }

  .researchitem > .backbone {
    position: relative;
    width: 100%;
    height: 100%;
    padding-top: 60px;
    box-sizing: border-box;
    background: #f8f8f8;
  }

  .researchitem > .backbone > .section {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .researchitem > .backbone > .section.outfocused {
    opacity: 0.2;
    filter: grayscale(1);
  }

  .researchitem > .backbone > .section td.outfocused {
    opacity: 0.2;
    filter: grayscale(1);
  }

  .researchitem > .backbone > .section.full {
    width: 100%;
    height: 100%;
    overflow-y: auto;
    /* display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column; */
  }

  .researchitem > .backbone > .section.full > .center {
    position: relative;
    width: calc(100% - 90px);
    /* height: 434px; */
    /* background: lightblue; */
  }

  .researchitem > .backbone > .section.full > .center > .pix {
    position: relative;
    width: 100%;
    padding-top: 100%;
    margin-bottom: 60px;
    /* background: orange; */
  }

  .researchitem > .backbone > .section.full > .center > .pix > img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
  }

  .researchitem > .backbone > .section.full > .center > .qatext,
  .researchitem > .backbone > .section.full > .center > .ox {
    position: relative;
    width: 100%;
    height: 90px;
    border-radius: 8px;
    box-shadow: 0px 0px 1px #999999;
    text-align: center;
    line-height: 90px;
    font-size: 12px;
    color: #999999;
  }

  .researchitem > .backbone > .section.full > .center > .ox > table {
    border-collapse: collapse;
    width: 100%;
    height: 100%;
  }

  .researchitem > .backbone > .section.full > .center > .ox > table td {
    width: 50%;
    box-sizing: border-box;
    position: relative;
    text-align: center;
    padding: 0;
  }

  .researchitem > .backbone > .section.full > .center > .ox > table td:first-child {
    border-right: 1px solid rgba(0,0,0,0.1);
  }

  .researchitem > .backbone > .section.full > .center > .ox > table td > img.ox {
    position: absolute;
    top: 0;
    left: 50%;
    height: 100%;
    width: auto;
    transform: translateX(-50%);
  }

  .researchitem > .backbone > .section.full.intro {
    display: block;
  }

  .researchitem > .backbone > .section.full > .subsection {
    width: 100%;
    display: flex;
    align-items: center;
    flex-direction: column;
  }

  .researchitem > .backbone > .section.full > .subsection.logo {
    height: 100px;
    /* background: orange; */
    justify-content: flex-end;
  }

  .researchitem > .backbone > .section.full > .subsection.header {
    height: 150px;
    /* background: lightblue; */
    justify-content: center;
    padding-left: 10%;
    padding-right: 10%;
    box-sizing: border-box;
    text-align: center;
  }

  .researchitem > .backbone > .section.full > .subsection.action {
    height: 75px;
    /* background: lightpink; */
    justify-content: flex-start;
  }

  .researchitem > .backbone > .section.full > .subsection.coverpix {
    /* background: orange; */
    justify-content: flex-start;
  }

  .researchitem > .backbone > .section.full > .subsection > .logo {
    width: 60px;
    height: 60px;
    background: white;
    border-radius: 100px;
    /* margin: 30px; */
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    box-sizing: border-box;
    /* border: 1px solid var(--color-dark); */
    box-shadow: 0px 0px 1px rgb(0, 0 ,0, 0.25);
  }

  .researchitem > .backbone > .section.full > .subsection > .logo > img {
    width: 90%;
    height: auto;
  }

  .researchitem > .backbone > .section.full > .subsection.coverpix > img {
    width: calc(100% - 32px);
    height: auto;
    object-fit: cover;
    box-sizing: border-box;
    border-radius: 8px;;
    opacity: 1;
    transition: all 0.5s;
  }

  .researchitem > .backbone > .section.full > .subsection.header > span.desc {
    /* font-weight: bold; */
    font-size: 12px;
    color: #777777;
    white-space: pre-line;
    text-align: center;
  }

  .researchitem > .backbone > .section.full > .subsection.header > span.category {
    /* font-weight: bold; */
    font-size: 12px;
    color: #777777;
  }

  .researchitem > .backbone > .section.full > .subsection.header > span.bname {
    font-weight: bold;
    font-size: 28px;
    margin-top: 10px;
  }

  .researchitem > .backbone > .section.full > .subsection.header > span.title {
    font-weight: bold;
    font-size: 24px;
    margin-top: 5px;
  }

  .researchitem > .backbone > .section.full > .subsection.action > span.gogo {
    font-weight: bold;
    font-size: 11px;
    /* margin-top: 20px; */
    background: #273B4A;
    width: 60px;
    height: 34px;
    line-height: 34px;
    border-radius: 15px;
    text-align: center;
    color: white;
    cursor: pointer;
  }






  .researchitem > .backbone > .section.full.outro > img {
    position: absolute;
    top: 20%;
    left: 16px;
    width: calc(100% - 32px);
    height: 60%;
    object-fit: cover;
    box-sizing: border-box;
    border-radius: var(--w-3);
    opacity: 0;
    transition: all 0.5s;
  }

  .researchitem > .backbone > .section.full.intro > img.loaded {
    opacity: 1;
  }

  .researchitem > .backbone > .section.full.outro > img.loaded {
    opacity: 0.3;
  }

  .researchitem > .backbone > .section.full > .cover {
    position: absolute;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    transition: all 0.3s;
  }

  .researchitem > .backbone > .section.full.intro > .cover {
    top: -50%;
    background: rgba(255,255,255,0.8);
  }

  .researchitem > .backbone > .section.full.intro > .cover.loaded {
    top: 0;
  }

  .researchitem > .backbone > .section.full.outro > .cover {
    bottom: 0;
  }

  .researchitem > .backbone > .section.full > .cover > .logo {
    width: 60px;
    height: 60px;
    background: white;
    border-radius: 100px;
    margin: 30px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    box-sizing: border-box;
    /* border: 1px solid var(--color-dark); */
    box-shadow: 0px 0px 1px rgb(0 0 0 / 25%);
  }

  .researchitem > .backbone > .section.full > .cover > .logo > img {
    width: 90%;
    height: auto;
  }

  .researchitem > .backbone > .section.full > .cover > span.bname {
    font-weight: bold;
    font-size: 28px;
  }

  .researchitem > .backbone > .section.full > .cover > span.category {
    font-weight: bold;
    font-size: 24px;
  }

  .researchitem > .backbone > .section.full > .cover > span.title {
    font-weight: bold;
    font-size: 28px;
    margin-top: 20px;
  }

  .researchitem > .backbone > .section.full > .cover > span.outment {
    font-size: 13px;
    margin-top: 20px;
    white-space: pre-line;
    text-align: center;
  }

  .researchitem > .backbone > .section.full > .cover > span.gogo {
    font-weight: bold;
    font-size: 11px;
    margin-top: 20px;
    background: var(--color-point);
    width: 60px;
    height: 34px;
    line-height: 34px;
    border-radius: 100px;
    text-align: center;
    color: white;
    cursor: pointer;
  }

  .researchitem > .backbone > .section.full > .cover > span.more {
    font-size: 13px;
    margin-top: 10px;
    background: #183394;
    width: 150px;
    height: 34px;
    line-height: 34px;
    border-radius: 100px;
    text-align: center;
    color: white;
    cursor: pointer;
  }


  .researchitem > .backbone > .section > .mc {
    position: absolute;
    left: 12px;
    right: 12px;
    top: 50%;
    /* height: 300px; */
    transform: translateY(-50%);
    /* background: lightpink; */
    display: flex;
    align-items: flex-start;
    justify-content: center;
    flex-wrap: wrap;
    flex-direction: row;
  }

  .researchitem > .backbone > .section.down > .mc {
    top: 45px;
    transform: none;
  }

  .researchitem > .backbone > .section > .mc > .square {
    position: relative;
    width: calc(100% / 3);
    padding-top: calc(100% / 3);
    /* background: lightblue; */
  }

  .researchitem > .backbone > .section > .mc > .square > .choice {
    position: absolute;
    top: 4px;
    left: 4px;
    right: 4px;
    bottom: 4px;
    border-radius: var(--w-3);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: white;
  }

  .researchitem > .backbone > .section > .mc > .square > .choice.nopix {
    background: rgba(0, 0, 0, 0.15);
  }

  .researchitem > .backbone > .section > .mc > .square > .choice.chosen {
    background: orange;
  }

  .researchitem > .backbone > .section > .mc > .square > .choice.chosen > img.mcpix {
    /* opacity: 0.3; */
    opacity: 0;
  }

  .researchitem > .backbone > .section > .mc > .square > .choice > img.mcpix {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: var(--w-3);
    filter: brightness(95%);
  }

  .researchitem > .backbone > .section > .mc > .square > .choice > span {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 80%;
    text-align: center;
    transform: translate(-50%, -50%);
  }

  .researchitem > .backbone > .section.pix {
    width: 100%;
    height: calc(50% + var(--square-size) * 0.4);
    top: 0;
  }

  .researchitem > .backbone > .section.down-left {
    width: 50%;
    height: calc(50% - var(--square-size) * 0.4 - var(--w-15));
    bottom: var(--w-15);
    left: 0;
  }

  .researchitem > .backbone > .section.down-right {
    width: 50%;
    height: calc(50% - var(--square-size) * 0.4 - var(--w-15));
    bottom: var(--w-15);
    right: 0;
  }

  .researchitem > .backbone > .section.up {
    width: 100%;
    height: 50%;
    top: 0;
  }

  .researchitem > .backbone > .section.down {
    width: 100%;
    height: 50%;
    bottom: 0;
  }

  .researchitem > .backbone > .section > img.candidate {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    object-fit: cover;
    transition: opacity 0.3s;
    border-radius: var(--w-3);
    filter: brightness(95%);
    background: white;
  }

  .researchitem > .backbone > .section > img.ox {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    object-fit: cover;
    transition: opacity 0.3s;
  }


  .researchitem > .backbone > .section.pix > img.candidate {
    width: var(--square-size);
    height: calc(var(--square-size) * 1.4);
    bottom: var(--w-1);
  }

  .researchitem > .backbone > .section.down-left > img.ox {
    width: 60%;
    height: auto;
  }

  .researchitem > .backbone > .section.down-right > img.ox {
    width: 60%;
    height: auto;
  }

  .researchitem > .backbone > .section.up > img.candidate {
    width: var(--square-size);
    height: var(--square-size);
    bottom: 1px;
  }

  .researchitem > .backbone > .section.down > img.candidate {
    width: var(--square-size);
    height: var(--square-size);
    top: 1px;
  }

  .researchitem > .backbone > .section > .label {
    text-align: center;
    position: absolute;
    /* width: calc(var(--square-size) * 0.8); */
    left: 53px;
    /* transform: translateX(-50%); */
    border-radius: 100px;
    white-space: pre-line;
    /* padding: 5px; */
    font-size: 13px;
    background: rgba(255,255,255,0.7);
    height: 30px;
    line-height: 30px;
    padding-left: 10px;
    padding-right: 10px;
    min-width: 70px;
    box-sizing: border-box;
  }

  .researchitem > .backbone > .section.up > .label {
    bottom: calc(var(--square-size) - 38px);
  }

  .researchitem > .backbone > .section.down > .label {
    top: calc(var(--square-size) - 38px);
  }

  .researchitem > .backbone > .divider {
    position: absolute;
    /* top: 0; */
    bottom: calc((100% - 60px) / 2);
    width: 100%;
    height: 0;
    background: white;
    /* top: 50%; */
    /* transform: translateY(-50%); */
  }

  .researchitem > .backbone > .divider > .vs {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border-radius: 100px;
    height: 45px;
    width: 45px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 18px;
  }

  .researchitem > .header {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 60px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 0 0 1px rgb(0, 0, 0, 0.1);
    border-radius: 0 0 15px 15px;
  }

  .researchitem > .header > .header-section {
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .researchitem > .header > .header-section.logo {
    width: 60px;
  }

  .researchitem > .header > .header-section.logo > .headlogo {
    width: 45px;
    height: 45px;
    /* background: orange; */
    border-radius: 100px;
    overflow: hidden;
    box-shadow: 0px 0px 1px #999999;
  }

  .researchitem > .header > .header-section.logo > .headlogo > img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .researchitem > .header > .header-section.question {
    width: calc(100% - 120px);
    font-size: 13px;
    text-align: center;
    white-space: pre-line;
  }

  .researchitem > .header > .header-section.npage {
    width: 60px;
  }

  .researchitem > .header > .header-section.logo > img {
    width: 70%;
    height: auto;
  }

  .researchitem > .header > .header-section.npage > .pagination {
    font-size: 12px;
  }

  .researchitem > .arrows {
    position: absolute;
    bottom: calc((100% - 60px) / 2);
    height: 0;
    left: 0;
    width: 100%;
    background: orange;
  }

  .researchitem > .arrows > .arrow {
    position: absolute;
    top: 50%;
    width: 45px;
    height: 45px;
    /* background: orange; */
    transform: translateY(-50%);
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
  }

  .researchitem > .arrows > .arrow.left {
    left: 0;
  }

  .researchitem > .arrows > .arrow.right {
    right: 0;
    transition: all 0.2s;
  }

  .researchitem > .arrows > .arrow.right.holded {
    right: -45px;
  }

  .researchitem > .arrows > .arrow > img {
    width: 100%;
    height: auto;
  }

  .researchitem > .arrows > .arrow.right > img {
    transform: rotate(180deg);
  }
</style>


<script type='text/x-template' id='researchitem-template'>
  <div class='researchitem' ref='post'>

    <div class='backbone' v-if='is_intro'>
      <div class='section full intro'>
        <div class='subsection logo'>
          <div class='logo' v-if='brand'>
            <img :src='brand.logo'>
          </div>
        </div>

        <div class='subsection header'>
          <span class='desc' v-if='research_desc'>[[ research_desc ]]</span>
          <!-- <span class='category' v-if='brand'>[[ brand.name_kr ]] 브랜드 서베이</span> -->
          <span class='bname' v-if='brand'>[[ brand.name_en ]]</span>
          <span class='title' v-if='research_title'>[[ research_title ]]</span>
        </div>

        <div class='subsection action'>
          <span class='gogo' @click='go_next'>시작하기</span>
        </div>

        <div class='subsection coverpix'>
          <img :src='researchitem.pix.pix_0' :class='{ loaded: pix_0_loaded }' @load='pix_0_loaded=true'>
        </div>
      </div>
    </div>


    <div class='backbone' v-if='is_outro'>
      <div class='section full outro'>
        <img :src='researchitem.pix.pix_0' :class='{ loaded: pix_0_loaded }' @load='pix_0_loaded=true'>

        <div class='cover' :class='{ loaded: pix_0_loaded }'>
          <span class='bname' v-if='brand'>[[ brand.name_en ]]</span>
          <!-- <span class='outment'>[[ outment ]]</span> -->
          <span class='outment'>[[ researchitem.text ]]</span>
          <!-- <span class='more support' @click='go_brander'>후원 이벤트 참여</span> -->
          <span class='more homepage' v-if='brand' @click='go_homepage'>브랜드 공식 사이트</span>
          <span class='more insta' v-if='brand' @click='go_insta'>브랜드 공식 인스타</span>
        </div>
      </div>
    </div>


    <div class='backbone' v-if='is_ab'>
      <div class='section up' :class='outfocused(1)'>
        <img class='candidate' :src='researchitem.pix.pix_0' @click='toggle_choose(0)'>
        <div class='label' v-if='researchitem.pix.pixlabel_0'>[[ researchitem.pix.pixlabel_0 ]]</div>
      </div>

      <div class='section down' :class='outfocused(0)'>
        <img class='candidate' :src='researchitem.pix.pix_1' @click='toggle_choose(1)'>
        <div class='label' v-if='researchitem.pix.pixlabel_1'>[[ researchitem.pix.pixlabel_1 ]]</div>
      </div>

      <div class='divider'>
        <div class='vs'>VS</div>
      </div>
    </div>


    <div class='backbone' v-if='is_ox'>
      <div class='section full'>
        <div class='center'>
          <div class='pix'>
            <img class='candidate' :src='researchitem.pix.pix_0'>
          </div>
          <div class='ox'>
            <table>
              <tbody>
                <tr>
                  <td :class='outfocused(1)' @click='toggle_choose(0)'>
                    <img class='ox' src='/static/materials/icons/O-button.png'>
                  </td>

                  <td :class='outfocused(0)' @click='toggle_choose(1)'>
                    <img class='ox' src='/static/materials/icons/X-button.png'>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- <div class='section pix'>
        <img class='candidate' :src='researchitem.pix.pix_0'>
      </div>

      <div class='section down-left' :class='outfocused(1)' @click='toggle_choose(0)'>
        <img class='ox' src='/static/materials/icons/O-button.png'>
      </div>

      <div class='section down-right' :class='outfocused(0)' @click='toggle_choose(1)'>
        <img class='ox' src='/static/materials/icons/X-button.png'>
      </div> -->
    </div>

    <div class='backbone' v-if='is_mc_nopix'>
      <div class='section full'>
        <div class='mc'>
          <div class='square' v-for='(c, idx) in researchitem.mc'>
            <div class='choice' :class='choice_class(c, idx)' @click='multi_choose(idx)'>
              <img class='mcpix' :src='c.mcpix' v-if='c.mcpix'>
              <span>[[ c.mclabel ? c.mclabel : '' ]]</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class='backbone' v-if='is_mc_pix'>
      <div class='section up'>
        <img class='candidate' :src='researchitem.pix.pix_0'>
      </div>

      <div class='section down'>
        <div class='mc'>
          <div class='square' v-for='(c, idx) in researchitem.mc'>
            <div class='choice' :class='choice_class(c, idx)' @click='multi_choose(idx)'>
              <img class='mcpix' :src='c.mcpix' v-if='c.mcpix'>
              <span>[[ c.mclabel ? c.mclabel : '' ]]</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class='backbone' v-if='is_qa'>
      <div class='section full'>
        <div class='center'>
          <div class='pix'>
            <img class='candidate' :src='researchitem.pix.pix_0'>
          </div>
          <div class='qatext' @click='edit_qatext'>
            <span class='qa_answer' v-if='answer[0]'>[[ answer[0] ]]</span>
            <span class='placeholder' v-else>답변을 입력해 주세요</span>
          </div>
        </div>
      </div>
    </div>


    <div class='header' v-if='on_mainstory'>
      <div class='header-section logo'>
        <div class='headlogo' v-if='brand'>
          <img :src='brand.logo'>
        </div>
      </div>

      <div class='header-section question'>
        <span v-if='on_mainstory'>[[ researchitem.text ]]</span>
      </div>

      <div class='header-section npage'>
        <div class='pagination' v-if='pagination'>[[ pagination ]]</div>
      </div>
    </div>

    <div class='arrows'>
      <!-- <div class='arrow left' v-if='!is_intro' @click.stop='go_prev'> -->
      <div class='arrow left' v-if='!is_beginning' @click.stop='go_prev'>
        <img src='/static/materials/icons/button-backward.png'>
      </div>

      <!-- <div class='arrow right' :class='{ holded: slide_holded }' v-if='on_mainstory' @click.stop='go_next'> -->
      <div class='arrow right' :class='{ holded: slide_holded }' v-if='!is_end' @click.stop='go_next'>  
        <img src='/static/materials/icons/button-backward.png'>
      </div>
    </div>

  </div>
</script>


<script>
  Vue.component('researchitem', {
    template: '#researchitem-template',
    delimiters: ['[[', ']]'],
    props: ['researchitem', 'research', 'brand', 'session', 'swiper', 'pagination', 'idx'],
    data: function() {
      return {
        status: -1,
        pix_0_loaded: false,
        pix_1_loaded: false,
        headcover_loaded: false,
        // qa_answer: ''
      }
    },

    // created: function() {
    //   this.status = this.vote_state;
    // },

    watch: {
      pix_0_loaded: function(_new, _old) {
        if (this.is_intro && _new) {
          this.$emit('intro_loaded');
        }
      },

      'swiper.realIndex': function(_new, _old) {
        if (this.swiper.isBeginning && this.is_intro) {
          this.release_slide();
          console.log('인트로');

        } else if (this.swiper.isEnd && this.is_outro) {
          // this.release_slide();
          if (!this.answers.finished && this.wallet) {
            this.wallet.receive('research', this.research_reward);

            fetch(`research/${this.research.id}/done`).then(x=>x.json()).then(console.log);
            this.answers.finished = true;

            setTimeout(() => { alert(this.research_reward + 'P가 지급되었습니다'); }, 500);
          }

          console.log('아웃트로');

        } else if (_new == this.idx+1) {
          if (this.answered) {
            this.release_slide();
            console.log('답변완료');

          } else {
            this.hold_slide();
            console.log('답변해주세요');
          }
        }
      },

      answered: function(_new, _old) {
        if (this.swiper) {
          if (this.swiper.realIndex == this.idx + 1) {
            if (_new) {
              this.release_slide();
              console.log('답변완료');
              setTimeout(() => { this.go_next() }, 300);

            } else {
              this.hold_slide();
              console.log('답변해주세요');
            }
          }
        }
      }

      // answered: {
      //   handler: function(_new, _old) {
      //     if (!_new && this.swiper) {
      //       if (this.swiper.realIndex == this.idx + 1) {
      //         console.log(1234324);
      //       }
      //     }
      //
      //   }, immediate: true
      // }

      // idx: function(_new, _old) {
        // if (this.swiper.realIndex == _new+1) {
        //   console.log(this.idx)
        // }
        // console.log(_new, this.idx);
      // },


      // answer: function(_new, _old) {
      //   console.log(_old, _new);
      //   const _answer = JSON.stringify(_new);
      //   const _url = `research/${this.research_id}/item/${this.researchitem.id}/answer/${_answer}`;
      //   fetch(_url).then(x=>x.json()).then(console.log)
      // }

      // vote_state: function(_new, _old) {
      //   this.status = this.vote_state;
      // }
    },


    computed: {
      myboo: function() {
        if (this.session.user.has_auth) {
          return this.session.user.boo
        }
      },

      wallet_loaded: function() {
        if (this.myboo) {
          return this.myboo.wallet != undefined
        }
      },

      wallet: function() {
        if (this.wallet_loaded) {
          return this.myboo.wallet
        }
      },

      answers: function() {
        if (this.research) {
          return this.research.answers
        }
      },

      answer: function() {
        if (this.answers) {
          if (!(this.researchitem.id in this.answers)) {
            this.$set(this.answers, this.researchitem.id, []);
          }

          return this.answers[this.researchitem.id]
        }
      },

      // not_answered: function() {
      //   if (this.answer) {
      //     return this.on_mainstory && (this.answer[0] == undefined)
      //   }
      // },

      answered: function() {
        if (this.answer) {
          if (this.on_mainstory) {
            return this.answer[0] != undefined

          } else {
            return true
          }
        }
      },

      // research: function() {
      //   return this.session.page.research.content
      // },


      research_desc: function() {
        if (this.research) {
          return this.research.desc
        }
      },

      research_title: function() {
        if (this.research) {
          return this.research.title
        }
      },
      // research_id: function() {
      //   return this.research.id
      // },

      research_reward: function() {
        if (this.research && this.research.reward) {
          return this.research.reward

        } else {
          return 0
        }
      },

      is_intro: function() {
        return this.researchitem.type == 'IN'
      },

      is_outro: function() {
        return this.researchitem.type == 'OUT'
      },

      is_ab: function() {
        return this.researchitem.type == 'AB'
      },

      is_ox: function() {
        return this.researchitem.type == 'OX'
      },

      is_mc_nopix: function() {
        return (this.researchitem.type == 'MC') && (this.researchitem.pix == undefined)
      },

      is_mc_pix: function() {
        return (this.researchitem.type == 'MC') && (this.researchitem.pix != undefined)
      },

      is_qa: function() {
        return this.researchitem.type == 'QA'
      },

      on_mainstory: function() {
        return !this.is_intro && !this.is_outro
      },

      slide_holded: function() {
        if (this.swiper) {
          return this.swiper.allowSlideNext == false
        }
      },

      is_beginning: function() {
        if (this.swiper) {
          return this.swiper.isBeginning
        }
      },

      is_end: function() {
        if (this.swiper) {
          return this.swiper.isEnd
        }
      }
    },


    methods: {
      hold_slide: function() {
        this.swiper.allowSlideNext = false;
      },

      release_slide: function() {
        this.swiper.allowSlideNext = true
      },

      go_brander: function() {
        this.session.open_brander(this.brand);
      },

      go_homepage: function() {
        window.open(this.brand.homepage);
      },

      go_insta: function() {
        window.open(this.brand.insta);
      },

      go_next: function() {
        if (this.swiper) {
          this.swiper.slideNext();
        }
      },

      go_prev: function() {
        if (this.swiper) {
          this.swiper.slidePrev();
        }
      },

      outfocused: function(act) {
        if (this.answer && this.answer.includes(act)) {
          return 'outfocused'
        }
      },

      choice_class: function(c, act) {
        return {
          chosen: this.answer ? this.answer.includes(act) : false,
          nopix: !c.mcpix
        }
      },

      answering: function() {
        const _answer = JSON.stringify(this.answer);
        const _url = `research/${this.research.id}/item/${this.researchitem.id}/answer/${_answer}`;
        fetch(_url).then(x=>x.json()).then(console.log)
      },

      edit_qatext: function() {
        this.session.open_texteditor(this.answer[0], '답변을 입력해 주세요', 1, txt_done => {
          if (txt_done == '') {
            this.answer.splice(0);

          } else {
            this.answer.splice(0, 1, txt_done);
          }

          this.answering();
        });
      },

      multi_choose: function(act) {
        if (this.answer) {
          if (this.answer.includes(act)) {
            const where = this.answer.indexOf(act);
            this.answer.splice(where, 1);

          } else {
            this.answer.push(act);
          }

          this.answering();
        }
      },

      // toggle_choose: function(act) {
      //   // 선택을 클리어하는 경우
      //   if (this.status==act) {
      //     this.status = -1;
      //     // this.session.user.contentvote(this.post.id, -1);
      //
      //   } else {
      //     this.status = act;
      //     // this.session.user.contentvote(this.post.id, act);
      //     // setTimeout(() => { this.swiper.slideNext() }, 300);
      //   }
      // },

      toggle_choose: function(act) {
        if (this.answer) {
          if (this.answer.includes(act)) {
            this.answer.splice(0); // 완전히 비우기
            // const where = this.answer.indexOf(act);
            // this.answer.splice(where, 1);

          } else {
            this.answer.splice(0); // 완전히 비우기
            this.answer.push(act);
          }

          this.answering();
        }
      }
    }
  });
</script>
