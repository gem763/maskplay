<link rel="stylesheet" href='/static/swiper/swiper.min.css'>

<script type='text/x-template' id='posts-template'>
  <div class="swiper-container" ref='swiper'>
    <div class="swiper-wrapper">

      <div class="swiper-slide" v-for='post in posts' :post_id='post.id' :author_id='post.boo.id'>
        <post :post=post :session=session></post>
      </div>

    </div>
  </div>
</script>

<script src="/static/swiper/swiper.js"></script>
{% include "getch/post.html" %}

<script>
  Vue.component('posts', {
    template: '#posts-template',
    delimiters: ['[[', ']]'],
    props: ['posts', 'session'],
    data: function() {
      return {
        swiper: undefined
      }
    },

    mounted: function() {
      this.swiper = new Swiper(this.$refs.swiper, {
        direction: 'vertical'
      });
    }
  });


  const swiper = new Swiper('.swiper-container2', {
    direction: 'vertical',
    on: {
      init: function() {
        // set_post();
      },
      slideChangeTransitionEnd: function() {
        set_post();
      },
      slideChange: function() {
        // unset_post();
      },
    },
    // spaceBetween: '-10'
    // loop: true
    // preventClicks: false,
    // preventClicksPropagation: false
  });

  function set_post() {
    const cpost = document.querySelector('.swiper-slide-active');
    const cpost_id = cpost.getAttribute('post_id');
    const author_id = cpost.getAttribute('author_id');

    session.cpost = {
      post_id: Number(cpost_id),
      author_id: Number(author_id)
    }

    // cpost.querySelector('.author.menublock').setAttribute('author', author_id);
    // cpost.querySelector('.author.menublock img.fit').src = session.author.profile.pix;
    // cpost.querySelector('.description span.nick').innerHTML = '@' + session.author.nick;
    //
    // if (author_id==session.boo_selected) {
    //   cpost.querySelector('input.show-modify-button.toggler').checked = true;
    //
    // } else {
    //   cpost.querySelector('input.show-modify-button.toggler').checked = false;
    // }
    //
    // if (cpost_id in session.boo.voting_record) {
    //   const vote_action = session.boo.voting_record[cpost_id];
    //   cpost.querySelector(`input.vote.toggler[value='${vote_action}']`).checked = true;
    //
    // } else {
    //   cpost.querySelector('input.vote.toggler[value="0"]').checked = false;
    //   cpost.querySelector('input.vote.toggler[value="1"]').checked = false;
    // }
  }
  //
  // function unset_post() {
  //   let cpost = document.querySelector('.swiper-slide-active');
  //   cpost.querySelector('input.show-modify-button.toggler').checked = false;
  //   cpost.querySelector('input.vote.toggler[value="0"]').checked = false;
  //   cpost.querySelector('input.vote.toggler[value="1"]').checked = false;
  // }
</script>
