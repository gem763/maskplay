<style>
  .page {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: none;
  }

  .page > .content {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: none;
    pointer-events: auto;
  }

  .page > .dimmer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
  }

  .page .show-content-enter-active,
  .page .show-content-leave-active,
  .page .show-content-from-right-enter-active,
  .page .show-content-from-right-leave-active,
  .page .show-content-from-left-enter-active,
  .page .show-content-from-left-leave-active,
  .page .show-content-from-top-enter-active,
  .page .show-content-from-top-leave-active,
  .page .show-content-from-bottom-enter-active,
  .page .show-content-from-bottom-leave-active,
  .page .show-dimmer-enter-active,
  .page .show-dimmer-leave-active {
    transition: all .3s;
  }

  .page .show-content-enter,
  .page .show-content-leave-to {
    opacity: 0;
  }

  .page .show-content-from-right-enter,
  .page .show-content-from-right-leave-to {
    left: 100%;
  }

  .page .show-content-from-left-enter,
  .page .show-content-from-left-leave-to {
    left: -100%;
  }

  .page .show-content-from-bottom-enter,
  .page .show-content-from-bottom-leave-to {
    top: 100%;
  }

  .page .show-content-from-top-enter,
  .page .show-content-from-top-leave-to {
    top: -100%;
  }

  .page .show-dimmer-enter,
  .page .show-dimmer-leave-to {
    background: rgba(0,0,0,0);
  }

  .page > .content > .close {
    position: absolute;
    top: 0;
    left: 0;
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
  }

  .page > .content > .close img {
    width: 6px;
    height: auto;
    transform: rotate(180deg);
    pointer-events: none;
  }

  .page > .content > .page-body {
    width: 100%;
    height: 100%;
    overflow-y: auto;
    -ms-overflow-style: none; /*IE 11*/
    scrollbar-width: none; /*Firefox 64*/
  }

  .page > .content > .page-body::-webkit-scrollbar {
    display: none;
  }
</style>


<script type='text/x-template' id='page-template'>
  <div class='page' :style='{ zIndex:order }'>
    <transition name='show-dimmer'>
      <div class='dimmer' v-show='open'></div>
    </transition>

    <transition :name='show_content_type'>
      <div class='content' v-show='open'>
        <div class='page-body' @scroll='scroll'>
          <slot name='page-body'></slot>
        </div>

        <div class='close' @click='$emit("close")' v-show='!hide_close'>
          <img src='/static/materials/icons/button-backward.png'>
        </div>
      </div>
    </transition>
  </div>
</script>


<script>
  Vue.component('page', {
    template: '#page-template',
    delimiters: ['[[', ']]'],
    props: ['open', 'from', 'hide_close', 'order'],
    data: function() {
      return {
        scrollTop: 0,
      }
    },

    computed: {
      show_content_type: function() {
        if (this.from) {
          return 'show-content-from-' + this.from

        } else {
          return 'show-content'
        }
      }
    },

    methods: {
      scroll_directize: function(scrollTop, clientHeight) {
        if ((scrollTop <= this.scrollTop) || (scrollTop < clientHeight*0.2)) {
          return 'up';
        } else {
          return 'down';
        }
      },

      scroll: function(event) {
        // https://www.w3schools.com/howto/tryit.asp?filename=tryhow_js_sticky_header
        const h0 = event.target.clientHeight;
        const h1 = event.target.scrollHeight;
        const scrollTop = event.target.scrollTop;
        const gap = h1 - scrollTop - h0;
        const triggered = (gap < h0/2);// && (this.session.scroll_direction=='down');
        const scroll_direction = this.scroll_directize(scrollTop, h0);
        this.scrollTop = scrollTop;

        this.$emit('scroll', { triggered: triggered, scroll_direction: scroll_direction });
      }
    }
  });
</script>
